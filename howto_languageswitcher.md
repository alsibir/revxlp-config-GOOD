# Как переключать языки

Ниже приведён пример конфигурации ZMK, в котором переключение раскладок реализовано отправкой на хост штатных сочетаний, принятых в настройках ПК:

* Left Alt + Shift — переключение на первую (английскую) раскладку;
* Right Alt + Shift — переключение на вторую (русскую) раскладку;
* GUI + Space — переключение между двумя последними использованными раскладками (циклическое/переключатель, не детерминированный выбор языка).

В конфигурации ниже:

* combo **J+K** отправляет на хост **Right Alt + Shift** (детерминированный выбор русской раскладки как «второй»);
* combo **D+F** отправляет на хост **Left Alt + Shift** (детерминированный выбор английской раскладки как «первой»).

Примечание: ZMK не переключает раскладки внутри ОС напрямую; прошивка отправляет только заданные сочетания клавиш. Детерминированность достигается именно тем, что ОС интерпретирует Left Alt + Shift как «всегда английская», а Right Alt + Shift как «всегда русская».

```dts
/ {
    macros {
        /* RU: отправка Right Alt + Shift.
         * На ПК настроено: Right Alt + Shift -> переключение на вторую (русскую) раскладку.
         * Действие детерминированное: всегда выбирается RU как вторая раскладка.
         */
        lang_ru: lang_ru {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <0>;
            tap-ms = <0>;
            bindings
                = <&macro_press   &kp RALT &kp LSHFT>
                , <&macro_release &kp LSHFT &kp RALT>
                ;
        };

        /* EN: отправка Left Alt + Shift.
         * На ПК настроено: Left Alt + Shift -> переключение на первую (английскую) раскладку.
         * Действие детерминированное: всегда выбирается EN как первая раскладка.
         */
        lang_en: lang_en {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <0>;
            tap-ms = <0>;
            bindings
                = <&macro_press   &kp LALT &kp LSHFT>
                , <&macro_release &kp LSHFT &kp LALT>
                ;
        };

        /* TOG: отправка GUI + Space.
         * На ПК настроено: GUI + Space -> переключение между двумя последними использованными раскладками.
         * Примечание: действие не является детерминированным выбором RU/EN, используется как "переключатель".
         */
        lang_tog: lang_tog {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <0>;
            tap-ms = <0>;
            bindings
                = <&macro_press   &kp LGUI>
                , <&macro_tap     &kp SPACE>
                , <&macro_release &kp LGUI>
                ;
        };
    };

    combos {
        compatible = "zmk,combos";

        /* J + K -> RU (Right Alt + Shift) */
        combo_lang_ru {
            timeout-ms = <120>;
            require-prior-idle-ms = <150>;
            /* позиции J=19, K=20 для приведённого ранее Base-слоя */
            key-positions = <19 20>;
            bindings = <&lang_ru>;
        };

        /* D + F -> EN (Left Alt + Shift) */
        combo_lang_en {
            timeout-ms = <120>;
            require-prior-idle-ms = <150>;
            /* позиции D=15, F=16 для приведённого ранее Base-слоя */
            key-positions = <15 16>;
            bindings = <&lang_en>;
        };

        /* Опционально: L + ; -> TOG (GUI + Space), если требуется быстрый переключатель "последние две раскладки".
         * Позиции следует подобрать под фактическую раскладку.
         */
        /*
        combo_lang_tog {
            timeout-ms = <120>;
            require-prior-idle-ms = <150>;
            key-positions = <22 34>;
            bindings = <&lang_tog>;
        };
        */
    };
};
```

Примечания по применению:

1. Если фактическая раскладка/порядок клавиш отличается, требуется пересчитать `key-positions` по нумерации ZMK (с 0, в порядке следования в `bindings` базового слоя).
2. Если на ПК отличается логика переключения (например, используется только GUI + Space), детерминированное включение RU/EN будет невозможно без назначения отдельных хоткеев «первая/вторая раскладка» на стороне ОС; в таком случае следует использовать только макрос `lang_tog` как «переключатель».
